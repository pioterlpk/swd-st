<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>SWD-ST | System Dyspozytorski</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
:root{
--bg:#f2f4f8;
--dark:#1c1f26;
--red:#b30000;
--panel:#ffffff;
--border:#e0e0e0;
}
*{box-sizing:border-box;font-family:Inter}
body{margin:0;background:var(--bg)}
.hidden{display:none}

/* LOGIN */
#login{
height:100vh;display:flex;justify-content:center;align-items:center;
background:linear-gradient(135deg,#6e0000,#b30000)
}
#login .box{
background:#fff;padding:30px;border-radius:12px;width:320px;
box-shadow:0 20px 40px rgba(0,0,0,.3)
}
#login h2{text-align:center;margin-bottom:20px}
#login input,#login button{
width:100%;padding:10px;margin-bottom:12px;font-size:14px
}
#login button{background:var(--red);color:#fff;border:none;border-radius:6px;cursor:pointer}

/* HEADER */
header{
background:var(--dark);color:#fff;padding:14px 20px;
display:flex;justify-content:space-between;align-items:center
}
header nav button{
background:none;border:none;color:#fff;
margin-right:12px;font-weight:600;cursor:pointer
}
header nav button:hover{color:#ff8080}

/* LAYOUT */
#app{
height:calc(100vh - 56px);
display:grid;
grid-template-columns:420px 1fr;
}

/* LEFT */
#left{
background:var(--panel);
border-right:1px solid var(--border);
overflow:auto
}
.event{
border-bottom:1px solid var(--border);
padding:14px;cursor:pointer
}
.event:hover{background:#f9f9f9}
.event h4{margin:0;font-size:14px}
.event small{color:#666}

.event-details{
margin-top:10px;font-size:13px;color:#333
}
.badge{
display:inline-block;padding:4px 8px;border-radius:20px;
font-size:11px;margin:2px;color:#fff
}
.WOLNY{background:#2ecc71}
.DYSPOZYCJA{background:#f1c40f;color:#000}
.W_DRODZE{background:#3498db}
.NA_MIEJSCU{background:#e74c3c}
.POWROT{background:#9b59b6}
.GOSPODARCZY{background:#7f8c8d}

/* MAP */
#map{height:100%}

/* MODALS */
.modal{
position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,.55);
display:flex;align-items:center;justify-content:center;
z-index:9999
}
.modal.hidden{display:none}
.modal .box{
background:#fff;padding:20px;border-radius:10px;width:360px
}
.modal input,.modal textarea,.modal select,.modal button{
width:100%;padding:8px;margin-bottom:10px
}
.modal button{
background:var(--red);color:#fff;border:none;border-radius:6px;cursor:pointer
}
.close{
float:right;border:none;background:none;font-size:18px;cursor:pointer
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
  <div class="box">
    <h2>System SWD-ST</h2>
    <input id="loginUser" placeholder="Login">
    <input id="loginPass" type="password" placeholder="Hasło">
    <button onclick="login()">Zaloguj</button>
    <small id="err" style="color:red"></small>
  </div>
</div>

<!-- APP -->
<div id="main" class="hidden">
<header>
  <strong>SWD-ST | Dyspozytornia</strong>
  <nav>
    <button onclick="openAddEvent()">+ Zgłoszenie</button>
    <button onclick="openAddUnit()">+ Jednostka</button>
  </nav>
</header>

<div id="app">
  <div id="left"></div>
  <div id="map"></div>
</div>
</div>

<!-- MODAL: EVENT -->
<div id="addEventModal" class="modal hidden" onclick="closeModals()">
 <div class="box" onclick="event.stopPropagation()">
  <button class="close" onclick="closeModals()">✖</button>
  <h3>Nowe zgłoszenie</h3>
  <input id="etitle" placeholder="Tytuł zgłoszenia">
  <textarea id="edesc" placeholder="Opis"></textarea>
  <input id="eloc" placeholder="Lokalizacja">
  <button onclick="addEvent()">Dodaj</button>
 </div>
</div>

<!-- MODAL: UNIT -->
<div id="addUnitModal" class="modal hidden" onclick="closeModals()">
 <div class="box" onclick="event.stopPropagation()">
  <button class="close" onclick="closeModals()">✖</button>
  <h3>Nowa jednostka</h3>
  <input id="uname" placeholder="Nazwa jednostki">
  <select id="ustatus">
    <option>WOLNY</option>
    <option>DYSPOZYCJA</option>
    <option>W_DRODZE</option>
    <option>NA_MIEJSCU</option>
    <option>POWROT</option>
    <option>GOSPODARCZY</option>
  </select>
  <button onclick="addUnit()">Dodaj</button>
 </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* LOGIN */
function login(){
 if(loginUser.value==="OSPLipowki" && loginPass.value==="Sylwek123"){
  login.style.display="none";
  main.classList.remove("hidden");
  init();
 }else err.textContent="Błędny login lub hasło";
}

/* MAP */
let map;
function init(){
 map=L.map('map').setView([51.9,21.6],10);
 L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
}

/* DATA */
let units=[
 {name:"OSP Garwolin",status:"WOLNY"},
 {name:"OSP Wilga",status:"W_DRODZE"}
];
let events=[];

/* RENDER */
function render(){
 left.innerHTML="";
 events.forEach(e=>{
  const d=document.createElement("div");
  d.className="event";
  d.innerHTML=`
   <h4>${e.title}</h4>
   <small>${e.loc}</small>
   <div class="event-details hidden">
     <p>${e.desc}</p>
     <p><strong>Data:</strong> ${e.date}</p>
     <p><strong>Jednostki:</strong><br>
       ${units.map(u=>`<span class="badge ${u.status}">${u.name} – ${u.status.replace("_"," ")}</span>`).join("")}
     </p>
   </div>`;
  d.onclick=()=>{
   d.querySelector(".event-details").classList.toggle("hidden");
   map.setView(e.marker.getLatLng(),13);
   e.marker.openPopup();
  };
  left.appendChild(d);
 });
}

/* EVENTS */
function addEvent(){
 const ev={
  title:etitle.value,
  desc:edesc.value,
  loc:eloc.value,
  date:new Date().toLocaleString(),
  marker:L.marker(map.getCenter()).addTo(map).bindPopup(etitle.value)
 };
 events.push(ev);
 closeModals();
 render();
}

/* UNITS */
function addUnit(){
 units.push({name:uname.value,status:ustatus.value});
 closeModals();
 render();
}

/* MODALS */
function openAddEvent(){document.getElementById("addEventModal").classList.remove("hidden")}
function openAddUnit(){document.getElementById("addUnitModal").classList.remove("hidden")}
function closeModals(){
 document.getElementById("addEventModal").classList.add("hidden");
 document.getElementById("addUnitModal").classList.add("hidden");
}
</script>

</body>
</html>
