<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>SWD-ST PRO | Dyspozytornia</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
--bg:#0e1014;
--panel:#151922;
--panel2:#1b2030;
--accent:#ff2a2a;
--accent2:#ff6a00;
--text:#e6e6e6;
--muted:#9aa0b3;
--glass:rgba(255,255,255,.04);
--blur:blur(14px);
}
*{box-sizing:border-box;font-family:Inter}
body{margin:0;background:var(--bg);color:var(--text)}
.hidden{display:none}

/* LOGIN */
#loginScreen{
height:100vh;display:flex;align-items:center;justify-content:center;
background:radial-gradient(circle at top,#300,#000)
}
.loginBox{
background:var(--panel);
padding:30px;border-radius:16px;width:320px;
box-shadow:0 0 60px #ff2a2a33
}
.loginBox h2{text-align:center;margin-bottom:20px}
.loginBox input,button{
width:100%;padding:12px;margin-bottom:12px;
border:none;border-radius:10px;
background:var(--panel2);color:var(--text)
}
.loginBox button{
background:linear-gradient(135deg,var(--accent),var(--accent2));
cursor:pointer;font-weight:700
}

/* HEADER */
header{
height:56px;
background:linear-gradient(90deg,#0f121a,#1b2030);
display:flex;align-items:center;justify-content:space-between;
padding:0 20px;border-bottom:1px solid #222
}
header nav button{
background:none;border:none;color:var(--text);
margin-left:15px;cursor:pointer;font-weight:600
}
header nav button:hover{color:var(--accent)}

/* LAYOUT */
#app{
display:grid;
grid-template-columns:380px 1fr;
height:calc(100vh - 56px)
}

/* LEFT PANEL */
#left{
background:var(--panel);
border-right:1px solid #222;
overflow:auto
}
.panelHeader{
padding:14px;
font-weight:700;
background:var(--glass);
backdrop-filter:var(--blur)
}
.event{
padding:14px;
border-bottom:1px solid #222;
cursor:pointer
}
.event:hover{background:#ffffff05}
.event h4{margin:0;font-size:14px}
.event small{color:var(--muted)}
.details{margin-top:10px;font-size:13px}

/* BADGES */
.badge{
padding:4px 8px;border-radius:20px;font-size:11px;
display:inline-block;margin:2px;font-weight:600
}
.WOLNY{background:#2ecc71;color:#000}
.DYSPOZYCJA{background:#f1c40f;color:#000}
.W_DRODZE{background:#3498db}
.NA_MIEJSCU{background:#e74c3c}
.POWROT{background:#9b59b6}
.GOSPODARCZY{background:#7f8c8d}

/* MAP */
#map{height:100%}

/* MODAL */
.modal{
position:fixed;inset:0;
background:rgba(0,0,0,.7);
display:flex;align-items:center;justify-content:center;
z-index:9999
}
.modalBox{
background:var(--panel);
padding:20px;border-radius:16px;width:360px
}
.modalBox input,.modalBox textarea,.modalBox select,.modalBox button{
width:100%;padding:10px;margin-bottom:10px;
background:var(--panel2);color:var(--text);
border:none;border-radius:10px
}
.modalBox button{
background:linear-gradient(135deg,var(--accent),var(--accent2));
font-weight:700;cursor:pointer
}
.close{
float:right;background:none;border:none;color:#fff;
font-size:18px;cursor:pointer
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen">
 <div class="loginBox">
  <h2>SWD-ST PRO</h2>
  <input id="loginUser" placeholder="Login">
  <input id="loginPass" type="password" placeholder="HasÅ‚o">
  <button onclick="login()">ZALOGUJ</button>
  <small id="loginErr" style="color:red"></small>
 </div>
</div>

<!-- APP -->
<div id="mainApp" class="hidden">
<header>
 <strong>ðŸš’ SWD-ST | DYSPONENT</strong>
 <nav>
  <button onclick="openEvent()">+ Zdarzenie</button>
  <button onclick="openUnit()">+ Jednostka</button>
  <span id="stats"></span>
 </nav>
</header>

<div id="app">
 <div id="left">
  <div class="panelHeader">Zdarzenia</div>
 </div>
 <div id="map"></div>
</div>
</div>

<!-- MODALS -->
<div id="eventModal" class="modal hidden" onclick="closeAll()">
 <div class="modalBox" onclick="event.stopPropagation()">
  <button class="close" onclick="closeAll()">âœ–</button>
  <h3>Nowe zdarzenie</h3>
  <input id="etitle" placeholder="TytuÅ‚">
  <textarea id="edesc" placeholder="Opis"></textarea>
  <button onclick="addEvent()">Dodaj</button>
 </div>
</div>

<div id="unitModal" class="modal hidden" onclick="closeAll()">
 <div class="modalBox" onclick="event.stopPropagation()">
  <button class="close" onclick="closeAll()">âœ–</button>
  <h3>Nowa jednostka</h3>
  <input id="uname" placeholder="Nazwa">
  <select id="ustatus">
    <option>WOLNY</option>
    <option>DYSPOZYCJA</option>
    <option>W_DRODZE</option>
    <option>NA_MIEJSCU</option>
    <option>POWROT</option>
    <option>GOSPODARCZY</option>
  </select>
  <button onclick="addUnit()">Dodaj</button>
 </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* LOGIN */
function login(){
 if(loginUser.value==="OSPLipowki" && loginPass.value==="Sylwek123"){
  loginScreen.style.display="none";
  mainApp.classList.remove("hidden");
  init();
 }else loginErr.textContent="BÅ‚Ä™dne dane";
}

/* MAP */
let map;
function init(){
 map=L.map('map').setView([51.9,21.6],10);
 L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
 render();
}

/* DATA */
let events=JSON.parse(localStorage.getItem("events")||"[]");
let units=JSON.parse(localStorage.getItem("units")||"[]");

/* RENDER */
function render(){
 left.innerHTML='<div class="panelHeader">Zdarzenia</div>';
 events.forEach((e,i)=>{
  const d=document.createElement("div");
  d.className="event";
  d.innerHTML=`
   <h4>${e.title}</h4>
   <small>${e.time}</small>
   <div class="details hidden">
    <p>${e.desc}</p>
    ${units.map(u=>`<span class="badge ${u.status}">${u.name}</span>`).join("")}
    <br><button onclick="delEvent(${i})">UsuÅ„</button>
   </div>`;
  d.onclick=()=>{
   d.querySelector(".details").classList.toggle("hidden");
   map.flyTo(e.pos,13);
  };
  left.appendChild(d);
 });
 stats.textContent=`ðŸš¨ ${events.length} | ðŸš’ ${units.length}`;
 localStorage.setItem("events",JSON.stringify(events));
 localStorage.setItem("units",JSON.stringify(units));
}

/* ADD */
function addEvent(){
 const pos=map.getCenter();
 events.push({
  title:etitle.value,
  desc:edesc.value,
  time:new Date().toLocaleString(),
  pos:[pos.lat,pos.lng]
 });
 L.marker(pos,{draggable:true}).addTo(map);
 closeAll();render();
}
function addUnit(){
 units.push({name:uname.value,status:ustatus.value});
 closeAll();render();
}
function delEvent(i){events.splice(i,1);render()}

/* MODALS */
function openEvent(){eventModal.classList.remove("hidden")}
function openUnit(){unitModal.classList.remove("hidden")}
function closeAll(){
 eventModal.classList.add("hidden");
 unitModal.classList.add("hidden");
}
</script>
</body>
</html>
