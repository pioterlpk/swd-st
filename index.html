<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>SWD-ST PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
--bg:#0c0f14;--panel:#141925;--panel2:#1b2233;
--accent:#ff2a2a;--text:#e8eaf0;--muted:#8c93a8;
}
*{box-sizing:border-box;font-family:Inter}
body{margin:0;background:var(--bg);color:var(--text)}
.hidden{display:none}
header{height:56px;background:#0f131c;display:flex;align-items:center;justify-content:space-between;padding:0 20px}
button{cursor:pointer}

#app{display:grid;grid-template-columns:360px 1fr;height:calc(100vh - 56px)}
#left{background:var(--panel);overflow:auto}
.panelHeader{padding:12px;font-weight:700;border-bottom:1px solid #222}
.event,.station{padding:12px;border-bottom:1px solid #222}
.event:hover,.station:hover{background:#ffffff08}
.badge{padding:4px 8px;border-radius:12px;font-size:11px;font-weight:600;margin:2px;display:inline-block}
.WOLNY{background:#2ecc71;color:#000}
.W_DRODZE{background:#3498db}
.NA_MIEJSCU{background:#e74c3c}
#map{height:100%}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.75);display:flex;justify-content:center;align-items:center;z-index:999}
.modalBox{background:var(--panel);padding:20px;border-radius:14px;width:360px}
.modalBox input,.modalBox select,.modalBox button{
width:100%;padding:10px;margin-bottom:10px;background:var(--panel2);border:none;border-radius:10px;color:#fff}
</style>
</head>

<body>

<header>
<strong>üöí SWD-ST PRO</strong>
<nav>
<button onclick="openStationModal()">+ Remiza</button>
<button onclick="openEventModal()">+ Zdarzenie</button>
</nav>
</header>

<div id="app">
<div id="left">
<div class="panelHeader">Zdarzenia</div>
<div id="events"></div>
<div class="panelHeader">Remizy</div>
<div id="stations"></div>
</div>
<div id="map"></div>
</div>

<!-- GOOGLE MAPS -->
<script src="https://maps.googleapis.com/maps/api/js?key=TWOJ_API_KEY"></script>

<script>
let map, directionsService;
let events=[], stations=[], vehiclesOnMap=[];

function init(){
 map=new google.maps.Map(document.getElementById("map"),{
  center:{lat:51.9,lng:21.6},zoom:10
 });
 directionsService=new google.maps.DirectionsService();
}
window.onload=init;

/* MODALE */
function modal(html){
 const m=document.createElement("div");
 m.className="modal";
 m.innerHTML=`<div class="modalBox">${html}<button onclick="closeModal()">Zamknij</button></div>`;
 document.body.appendChild(m);
}
function closeModal(){document.querySelectorAll(".modal").forEach(m=>m.remove())}

/* REMIZA */
function openStationModal(){
 modal(`
 <h3>Nowa remiza</h3>
 <input id="sName" placeholder="Nazwa">
 <button onclick="addStation()">Dodaj</button>`);
}
function addStation(){
 stations.push({
  name:sName.value,
  pos:map.getCenter(),
  firefighters:[],
  vehicles:[]
 });
 closeModal();render();
}

/* STRA≈ªACY I WOZY */
function manageStation(i){
 const s=stations[i];
 modal(`
 <h3>${s.name}</h3>
 <input id="ff" placeholder="Stra≈ºak">
 <button onclick="stations[${i}].firefighters.push(ff.value);manageStation(${i})">+ Stra≈ºak</button>
 <input id="vh" placeholder="W√≥z">
 <button onclick="stations[${i}].vehicles.push({name:vh.value,status:'WOLNY'});manageStation(${i})">+ W√≥z</button>
 <p>Stra≈ºacy: ${s.firefighters.join(", ")}</p>
 <p>Wozy: ${s.vehicles.map(v=>v.name).join(", ")}</p>
 `);
}

/* ZDARZENIA */
function openEventModal(){
 modal(`
 <h3>Nowe zdarzenie</h3>
 <input id="eTitle" placeholder="Tytu≈Ç">
 <button onclick="addEvent()">Dodaj</button>`);
}
function addEvent(){
 const pos=map.getCenter();
 events.push({title:eTitle.value,pos});
 new google.maps.Marker({position:pos,map});
 closeModal();render();
}

/* WYS≈ÅANIE JEDNOSTKI */
function dispatch(ei){
 modal(`
 <h3>Wy≈õlij jednostkƒô</h3>
 <select id="sSel">${stations.map((s,i)=>`<option value="${i}">${s.name}</option>`).join("")}</select>
 <select id="vSel"></select>
 <button onclick="sendUnit(${ei})">WY≈öLIJ</button>
 `);
 updateVehicles();
 sSel.onchange=updateVehicles;
}
function updateVehicles(){
 const s=stations[sSel.value];
 vSel.innerHTML=s.vehicles.map((v,i)=>`<option value="${i}">${v.name}</option>`).join("");
}

function sendUnit(ei){
 const s=stations[sSel.value];
 const v=s.vehicles[vSel.value];
 v.status="W_DRODZE";
 animateVehicle(s.pos,events[ei].pos,v.name);
 closeModal();render();
}

/* ANIMACJA */
function animateVehicle(start,end,label){
 directionsService.route({
  origin:start,destination:end,travelMode:"DRIVING"
 },(res,stat)=>{
  if(stat!=="OK")return;
  const path=res.routes[0].overview_path;
  const marker=new google.maps.Marker({position:path[0],map,label:"üöí"});
  let i=0;
  const int=setInterval(()=>{
   i++;
   if(i>=path.length){clearInterval(int);return}
   marker.setPosition(path[i]);
  },300);
 });
}

/* RENDER */
function render(){
 eventsDiv.innerHTML="";
 events.forEach((e,i)=>{
  eventsDiv.innerHTML+=`
  <div class="event">
   <b>${e.title}</b><br>
   <button onclick="dispatch(${i})">Wy≈õlij jednostkƒô</button>
  </div>`;
 });
 stationsDiv.innerHTML="";
 stations.forEach((s,i)=>{
  stationsDiv.innerHTML+=`
  <div class="station" onclick="manageStation(${i})">
   <b>${s.name}</b><br>
   üë®‚Äçüöí ${s.firefighters.length} | üöí ${s.vehicles.length}
  </div>`;
 });
}
</script>

</body>
</html>
